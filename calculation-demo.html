<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最大光通量计算过程演示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        h3 {
            color: #7f8c8d;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        .input-section {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .color-input {
            flex: 1;
            min-width: 250px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            border: 2px solid transparent;
        }
        
        .color-input.red {
            border-color: #e74c3c;
        }
        
        .color-input.green {
            border-color: #27ae60;
        }
        
        .color-input.blue {
            border-color: #3498db;
        }
        
        .color-input.target {
            border-color: #9b59b6;
        }
        
        .color-input h4 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
        }
        
        label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }
        
        input[type="number"] {
            width: 120px;
            padding: 5px 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .calculate-btn {
            display: block;
            width: 300px;
            margin: 30px auto;
            padding: 15px;
            background-color: #3498db;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .calculate-btn:hover {
            background-color: #2980b9;
        }
        
        .step-section {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            display: none;
        }
        
        .step-section.active {
            display: block;
        }
        
        .explanation {
            background-color: #e8f5ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.8;
        }
        
        .formula {
            background-color: #fff;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 15px 0;
            font-family: "Courier New", monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .matrix {
            display: inline-block;
            vertical-align: middle;
            margin: 0 10px;
        }
        
        .matrix-bracket {
            display: inline-block;
            vertical-align: middle;
            font-size: 40px;
            font-weight: 100;
        }
        
        .matrix-content {
            display: inline-block;
            vertical-align: middle;
        }
        
        .matrix-row {
            display: block;
            text-align: center;
            margin: 5px 0;
        }
        
        .matrix-cell {
            display: inline-block;
            width: 80px;
            text-align: center;
            padding: 0 5px;
        }
        
        .result-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .error-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            color: #721c24;
            display: none;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .small-text {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .warning {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .success {
            color: #27ae60;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>最大光通量计算过程详细演示</h1>
        
        <div class="input-section">
            <h2>第一步：输入数据</h2>
            <div class="explanation">
                请输入RGB三基色的色坐标(x, y)和最大光通量限制，以及目标色的色坐标。
                色坐标范围为0到1之间，光通量为正数。
            </div>
            
            <div class="input-group">
                <div class="color-input red">
                    <h4>🔴 红色 (R)</h4>
                    <div class="input-row">
                        <label>x坐标:</label>
                        <input type="number" id="red-x" step="0.0001" min="0" max="1" value="0.7">
                    </div>
                    <div class="input-row">
                        <label>y坐标:</label>
                        <input type="number" id="red-y" step="0.0001" min="0" max="1" value="0.3">
                    </div>
                    <div class="input-row">
                        <label>最大光通量:</label>
                        <input type="number" id="red-max" step="0.1" min="0" value="100">
                    </div>
                </div>
                
                <div class="color-input green">
                    <h4>🟢 绿色 (G)</h4>
                    <div class="input-row">
                        <label>x坐标:</label>
                        <input type="number" id="green-x" step="0.0001" min="0" max="1" value="0.2">
                    </div>
                    <div class="input-row">
                        <label>y坐标:</label>
                        <input type="number" id="green-y" step="0.0001" min="0" max="1" value="0.7">
                    </div>
                    <div class="input-row">
                        <label>最大光通量:</label>
                        <input type="number" id="green-max" step="0.1" min="0" value="100">
                    </div>
                </div>
                
                <div class="color-input blue">
                    <h4>🔵 蓝色 (B)</h4>
                    <div class="input-row">
                        <label>x坐标:</label>
                        <input type="number" id="blue-x" step="0.0001" min="0" max="1" value="0.1">
                    </div>
                    <div class="input-row">
                        <label>y坐标:</label>
                        <input type="number" id="blue-y" step="0.0001" min="0" max="1" value="0.1">
                    </div>
                    <div class="input-row">
                        <label>最大光通量:</label>
                        <input type="number" id="blue-max" step="0.1" min="0" value="100">
                    </div>
                </div>
                
                <div class="color-input target">
                    <h4>🎯 目标色</h4>
                    <div class="input-row">
                        <label>x坐标:</label>
                        <input type="number" id="target-x" step="0.0001" min="0" max="1" value="0.3333">
                    </div>
                    <div class="input-row">
                        <label>y坐标:</label>
                        <input type="number" id="target-y" step="0.0001" min="0" max="1" value="0.3333">
                    </div>
                    <div class="small-text">
                        提示：(0.3333, 0.3333) 是白色
                    </div>
                </div>
            </div>
        </div>
        
        <button class="calculate-btn" onclick="startCalculation()">开始计算</button>
        
        <div id="error-message" class="error-box"></div>
        
        <!-- 步骤2：基本概念解释 -->
        <div id="step2" class="step-section">
            <h2>第二步：理解基本概念</h2>
            
            <h3>什么是色坐标？</h3>
            <div class="explanation">
                在CIE 1931色度系统中，任何颜色都可以用三个坐标(x, y, z)来表示。
                由于x + y + z = 1（归一化条件），我们只需要知道x和y就能确定一个颜色。
            </div>
            
            <h3>计算z坐标</h3>
            <div class="formula">
                z = 1 - x - y
            </div>
            
            <div id="z-calculations" class="result-box"></div>
            
            <h3>什么是光通量？</h3>
            <div class="explanation">
                光通量（Luminous flux）表示光源发出的总光量，单位通常是流明(lm)。
                在我们的计算中，它表示每个基色的亮度。
            </div>
        </div>
        
        <!-- 步骤3：建立方程组 -->
        <div id="step3" class="step-section">
            <h2>第三步：建立线性方程组</h2>
            
            <h3>颜色混合原理</h3>
            <div class="explanation">
                当RGB三种光混合时，合成色的坐标是各基色坐标的加权平均，权重就是各基色的光通量。
                我们需要找到合适的RGB光通量比例，使得混合后得到目标色。
            </div>
            
            <h3>方程组推导</h3>
            <div class="explanation">
                设红色光通量为L<sub>r</sub>，绿色为L<sub>g</sub>，蓝色为L<sub>b</sub>，总光通量为L<sub>t</sub>，则有：
            </div>
            
            <div class="formula">
                <div>第一个方程（x坐标平衡）：</div>
                <div>(x<sub>r</sub>/y<sub>r</sub>)·L<sub>r</sub> + (x<sub>g</sub>/y<sub>g</sub>)·L<sub>g</sub> + (x<sub>b</sub>/y<sub>b</sub>)·L<sub>b</sub> = (x<sub>t</sub>/y<sub>t</sub>)·L<sub>t</sub></div>
                <br>
                <div>第二个方程（光通量守恒）：</div>
                <div>L<sub>r</sub> + L<sub>g</sub> + L<sub>b</sub> = L<sub>t</sub></div>
                <br>
                <div>第三个方程（z坐标平衡）：</div>
                <div>(z<sub>r</sub>/y<sub>r</sub>)·L<sub>r</sub> + (z<sub>g</sub>/y<sub>g</sub>)·L<sub>g</sub> + (z<sub>b</sub>/y<sub>b</sub>)·L<sub>b</sub> = (z<sub>t</sub>/y<sub>t</sub>)·L<sub>t</sub></div>
            </div>
            
            <h3>标准化处理</h3>
            <div class="explanation">
                为了简化计算，我们先假设总光通量L<sub>t</sub> = 1，求出各基色的比例。
                这样方程组变为：
            </div>
            
            <div id="matrix-equation" class="formula"></div>
        </div>
        
        <!-- 步骤4：求解方程组 -->
        <div id="step4" class="step-section">
            <h2>第四步：求解线性方程组</h2>
            
            <h3>使用高斯消元法</h3>
            <div class="explanation">
                我们使用高斯消元法来求解这个3×3的线性方程组。这个方法通过行变换将系数矩阵化为上三角形式，
                然后通过回代求解。
            </div>
            
            <div id="gaussian-steps" class="formula"></div>
            
            <h3>求解结果</h3>
            <div id="solution-result" class="result-box"></div>
        </div>
        
        <!-- 步骤5：计算缩放因子 -->
        <div id="step5" class="step-section">
            <h2>第五步：计算最大可能的光通量</h2>
            
            <h3>理解限制条件</h3>
            <div class="explanation">
                我们已经知道了达到目标色所需的RGB比例，但每个基色都有最大光通量限制。
                现在要找出在不超过任何限制的情况下，能达到的最大总光通量。
            </div>
            
            <h3>计算缩放因子</h3>
            <div class="explanation">
                对于每个基色，计算其最大光通量与所需比例的比值：
            </div>
            
            <div id="scale-factors" class="formula"></div>
            
            <h3>确定限制因子</h3>
            <div class="explanation">
                最小的缩放因子决定了最大可能的总光通量。这是因为一旦某个基色达到其最大值，
                就不能再增加总光通量了。
            </div>
            
            <div id="limiting-factor" class="result-box"></div>
        </div>
        
        <!-- 步骤6：最终结果 -->
        <div id="step6" class="step-section">
            <h2>第六步：计算最终结果</h2>
            
            <h3>最大总光通量</h3>
            <div id="max-luminance" class="result-box"></div>
            
            <h3>各基色的实际使用量</h3>
            <table id="usage-table">
                <thead>
                    <tr>
                        <th>基色</th>
                        <th>所需比例</th>
                        <th>实际使用量</th>
                        <th>最大限制</th>
                        <th>使用率</th>
                    </tr>
                </thead>
                <tbody id="usage-tbody">
                </tbody>
            </table>
            
            <h3>结论</h3>
            <div id="conclusion" class="explanation"></div>
        </div>
    </div>
    
    <script>
        function startCalculation() {
            // 清除之前的计算结果
            document.querySelectorAll('.step-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('error-message').style.display = 'none';
            
            // 读取输入数据
            const data = {
                red: {
                    x: parseFloat(document.getElementById('red-x').value),
                    y: parseFloat(document.getElementById('red-y').value),
                    max: parseFloat(document.getElementById('red-max').value)
                },
                green: {
                    x: parseFloat(document.getElementById('green-x').value),
                    y: parseFloat(document.getElementById('green-y').value),
                    max: parseFloat(document.getElementById('green-max').value)
                },
                blue: {
                    x: parseFloat(document.getElementById('blue-x').value),
                    y: parseFloat(document.getElementById('blue-y').value),
                    max: parseFloat(document.getElementById('blue-max').value)
                },
                target: {
                    x: parseFloat(document.getElementById('target-x').value),
                    y: parseFloat(document.getElementById('target-y').value)
                }
            };
            
            // 验证输入
            if (!validateInput(data)) {
                return;
            }
            
            // 开始逐步计算
            setTimeout(() => step2_calculateZ(data), 100);
        }
        
        function validateInput(data) {
            // 检查是否有空值
            for (let color in data) {
                for (let prop in data[color]) {
                    if (isNaN(data[color][prop])) {
                        showError('请填写所有输入项！');
                        return false;
                    }
                }
            }
            
            // 检查坐标范围
            for (let color in data) {
                if (data[color].x < 0 || data[color].x > 1 || data[color].y < 0 || data[color].y > 1) {
                    showError('色坐标必须在0到1之间！');
                    return false;
                }
            }
            
            // 检查y坐标不为0
            for (let color in data) {
                if (data[color].y <= 0) {
                    showError('y坐标不能为0或负数！');
                    return false;
                }
            }
            
            // 检查最大光通量
            if (data.red.max <= 0 || data.green.max <= 0 || data.blue.max <= 0) {
                showError('最大光通量必须大于0！');
                return false;
            }
            
            return true;
        }
        
        function showError(message) {
            const errorBox = document.getElementById('error-message');
            errorBox.textContent = message;
            errorBox.style.display = 'block';
        }
        
        function step2_calculateZ(data) {
            document.getElementById('step2').classList.add('active');
            
            // 计算z坐标
            data.red.z = 1 - data.red.x - data.red.y;
            data.green.z = 1 - data.green.x - data.green.y;
            data.blue.z = 1 - data.blue.x - data.blue.y;
            data.target.z = 1 - data.target.x - data.target.y;
            
            // 显示计算结果
            const zCalc = document.getElementById('z-calculations');
            zCalc.innerHTML = `
                <div>红色：z<sub>r</sub> = 1 - ${data.red.x.toFixed(4)} - ${data.red.y.toFixed(4)} = <span class="highlight">${data.red.z.toFixed(4)}</span></div>
                <div>绿色：z<sub>g</sub> = 1 - ${data.green.x.toFixed(4)} - ${data.green.y.toFixed(4)} = <span class="highlight">${data.green.z.toFixed(4)}</span></div>
                <div>蓝色：z<sub>b</sub> = 1 - ${data.blue.x.toFixed(4)} - ${data.blue.y.toFixed(4)} = <span class="highlight">${data.blue.z.toFixed(4)}</span></div>
                <div>目标色：z<sub>t</sub> = 1 - ${data.target.x.toFixed(4)} - ${data.target.y.toFixed(4)} = <span class="highlight">${data.target.z.toFixed(4)}</span></div>
            `;
            
            setTimeout(() => step3_buildEquations(data), 1000);
        }
        
        function step3_buildEquations(data) {
            document.getElementById('step3').classList.add('active');
            
            // 构建系数矩阵
            const A = [
                [data.red.x / data.red.y, data.green.x / data.green.y, data.blue.x / data.blue.y],
                [1, 1, 1],
                [data.red.z / data.red.y, data.green.z / data.green.y, data.blue.z / data.blue.y]
            ];
            
            const b = [
                data.target.x / data.target.y,
                1,
                data.target.z / data.target.y
            ];
            
            // 显示矩阵方程
            const matrixEq = document.getElementById('matrix-equation');
            matrixEq.innerHTML = `
                <div style="text-align: center;">
                    <div class="matrix">
                        <span class="matrix-bracket">[</span>
                        <div class="matrix-content">
                            <div class="matrix-row">
                                <span class="matrix-cell">${A[0][0].toFixed(3)}</span>
                                <span class="matrix-cell">${A[0][1].toFixed(3)}</span>
                                <span class="matrix-cell">${A[0][2].toFixed(3)}</span>
                            </div>
                            <div class="matrix-row">
                                <span class="matrix-cell">${A[1][0].toFixed(3)}</span>
                                <span class="matrix-cell">${A[1][1].toFixed(3)}</span>
                                <span class="matrix-cell">${A[1][2].toFixed(3)}</span>
                            </div>
                            <div class="matrix-row">
                                <span class="matrix-cell">${A[2][0].toFixed(3)}</span>
                                <span class="matrix-cell">${A[2][1].toFixed(3)}</span>
                                <span class="matrix-cell">${A[2][2].toFixed(3)}</span>
                            </div>
                        </div>
                        <span class="matrix-bracket">]</span>
                    </div>
                    ×
                    <div class="matrix">
                        <span class="matrix-bracket">[</span>
                        <div class="matrix-content">
                            <div class="matrix-row"><span class="matrix-cell">r</span></div>
                            <div class="matrix-row"><span class="matrix-cell">g</span></div>
                            <div class="matrix-row"><span class="matrix-cell">b</span></div>
                        </div>
                        <span class="matrix-bracket">]</span>
                    </div>
                    =
                    <div class="matrix">
                        <span class="matrix-bracket">[</span>
                        <div class="matrix-content">
                            <div class="matrix-row"><span class="matrix-cell">${b[0].toFixed(3)}</span></div>
                            <div class="matrix-row"><span class="matrix-cell">${b[1].toFixed(3)}</span></div>
                            <div class="matrix-row"><span class="matrix-cell">${b[2].toFixed(3)}</span></div>
                        </div>
                        <span class="matrix-bracket">]</span>
                    </div>
                </div>
                <div style="margin-top: 15px; text-align: center; color: #7f8c8d;">
                    其中 r, g, b 是红、绿、蓝三基色的光通量比例（总和为1）
                </div>
            `;
            
            // 保存数据供下一步使用
            data.A = A;
            data.b = b;
            
            setTimeout(() => step4_solveEquations(data), 1500);
        }
        
        function step4_solveEquations(data) {
            document.getElementById('step4').classList.add('active');
            
            try {
                // 求解线性方程组
                const solution = solveLinearSystem(data.A, data.b);
                
                // 检查解的有效性
                if (solution[0] < 0 || solution[1] < 0 || solution[2] < 0) {
                    showError('目标色在RGB三角形外部，无法通过RGB混合得到！');
                    document.getElementById('solution-result').innerHTML = 
                        '<span class="warning">计算得到负值，表示目标色无法实现</span>';
                    return;
                }
                
                // 显示求解过程
                document.getElementById('gaussian-steps').innerHTML = `
                    <div>使用高斯消元法求解...</div>
                    <div style="margin-top: 10px;">经过行变换和回代，得到解：</div>
                `;
                
                // 显示解
                document.getElementById('solution-result').innerHTML = `
                    <div>红色比例 r = <span class="highlight">${solution[0].toFixed(4)}</span></div>
                    <div>绿色比例 g = <span class="highlight">${solution[1].toFixed(4)}</span></div>
                    <div>蓝色比例 b = <span class="highlight">${solution[2].toFixed(4)}</span></div>
                    <div style="margin-top: 10px;">验证：r + g + b = ${(solution[0] + solution[1] + solution[2]).toFixed(4)} ≈ 1.000 ✓</div>
                `;
                
                // 保存解
                data.ratios = {
                    red: solution[0],
                    green: solution[1],
                    blue: solution[2]
                };
                
                setTimeout(() => step5_calculateScaling(data), 1500);
                
            } catch (error) {
                showError('方程组求解失败：' + error.message);
            }
        }
        
        function step5_calculateScaling(data) {
            document.getElementById('step5').classList.add('active');
            
            // 计算缩放因子
            const scaleFactors = {
                red: data.red.max / data.ratios.red,
                green: data.green.max / data.ratios.green,
                blue: data.blue.max / data.ratios.blue
            };
            
            // 找出最小缩放因子
            let minScale = Math.min(scaleFactors.red, scaleFactors.green, scaleFactors.blue);
            let limitingColor = '';
            
            if (minScale === scaleFactors.red) limitingColor = '红色';
            else if (minScale === scaleFactors.green) limitingColor = '绿色';
            else limitingColor = '蓝色';
            
            // 显示缩放因子计算
            document.getElementById('scale-factors').innerHTML = `
                <div>红色缩放因子：k<sub>r</sub> = ${data.red.max} ÷ ${data.ratios.red.toFixed(4)} = <span class="highlight">${scaleFactors.red.toFixed(2)}</span></div>
                <div>绿色缩放因子：k<sub>g</sub> = ${data.green.max} ÷ ${data.ratios.green.toFixed(4)} = <span class="highlight">${scaleFactors.green.toFixed(2)}</span></div>
                <div>蓝色缩放因子：k<sub>b</sub> = ${data.blue.max} ÷ ${data.ratios.blue.toFixed(4)} = <span class="highlight">${scaleFactors.blue.toFixed(2)}</span></div>
            `;
            
            // 显示限制因子
            document.getElementById('limiting-factor').innerHTML = `
                <div>最小缩放因子：<span class="highlight">${minScale.toFixed(2)}</span></div>
                <div>限制因子：<span class="warning">${limitingColor}</span>将首先达到其最大值</div>
            `;
            
            // 保存结果
            data.minScale = minScale;
            data.limitingColor = limitingColor;
            
            setTimeout(() => step6_showResults(data), 1500);
        }
        
        function step6_showResults(data) {
            document.getElementById('step6').classList.add('active');
            
            // 计算最终结果
            const maxLuminance = data.minScale;
            const usage = {
                red: data.ratios.red * data.minScale,
                green: data.ratios.green * data.minScale,
                blue: data.ratios.blue * data.minScale
            };
            
            // 显示最大光通量
            document.getElementById('max-luminance').innerHTML = `
                目标色能达到的最大总光通量：<span class="highlight" style="font-size: 24px;">${maxLuminance.toFixed(2)}</span>
            `;
            
            // 填充使用量表格
            const tbody = document.getElementById('usage-tbody');
            tbody.innerHTML = `
                <tr>
                    <td style="color: #e74c3c; font-weight: bold;">红色</td>
                    <td>${data.ratios.red.toFixed(4)}</td>
                    <td>${usage.red.toFixed(2)}</td>
                    <td>${data.red.max}</td>
                    <td>${(usage.red / data.red.max * 100).toFixed(1)}%</td>
                </tr>
                <tr>
                    <td style="color: #27ae60; font-weight: bold;">绿色</td>
                    <td>${data.ratios.green.toFixed(4)}</td>
                    <td>${usage.green.toFixed(2)}</td>
                    <td>${data.green.max}</td>
                    <td>${(usage.green / data.green.max * 100).toFixed(1)}%</td>
                </tr>
                <tr>
                    <td style="color: #3498db; font-weight: bold;">蓝色</td>
                    <td>${data.ratios.blue.toFixed(4)}</td>
                    <td>${usage.blue.toFixed(2)}</td>
                    <td>${data.blue.max}</td>
                    <td>${(usage.blue / data.blue.max * 100).toFixed(1)}%</td>
                </tr>
            `;
            
            // 显示结论
            document.getElementById('conclusion').innerHTML = `
                <div class="success">
                    在给定的RGB最大光通量限制下，目标色(${data.target.x.toFixed(3)}, ${data.target.y.toFixed(3)})
                    能够达到的最大光通量为 ${maxLuminance.toFixed(2)}。
                </div>
                <div style="margin-top: 10px;">
                    ${data.limitingColor}达到了其最大值 ${data[data.limitingColor.replace('色', '')].max}，
                    成为限制因素。如果想要更高的总光通量，需要提高${data.limitingColor}的最大光通量限制。
                </div>
            `;
        }
        
        // 求解线性方程组的函数
        function solveLinearSystem(A, b) {
            const n = A.length;
            
            // 创建增广矩阵
            const augmented = [];
            for (let i = 0; i < n; i++) {
                augmented.push([...A[i], b[i]]);
            }
            
            // 高斯消元
            for (let i = 0; i < n; i++) {
                // 找主元
                let maxRow = i;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(augmented[k][i]) > Math.abs(augmented[maxRow][i])) {
                        maxRow = k;
                    }
                }
                
                // 交换行
                [augmented[i], augmented[maxRow]] = [augmented[maxRow], augmented[i]];
                
                // 检查主元是否为0
                if (Math.abs(augmented[i][i]) < 1e-10) {
                    throw new Error('矩阵奇异，无法求解');
                }
                
                // 消元
                for (let k = i + 1; k < n; k++) {
                    const factor = augmented[k][i] / augmented[i][i];
                    for (let j = i; j <= n; j++) {
                        augmented[k][j] -= factor * augmented[i][j];
                    }
                }
            }
            
            // 回代
            const x = new Array(n);
            for (let i = n - 1; i >= 0; i--) {
                x[i] = augmented[i][n];
                for (let j = i + 1; j < n; j++) {
                    x[i] -= augmented[i][j] * x[j];
                }
                x[i] /= augmented[i][i];
            }
            
            return x;
        }
    </script>
</body>
</html>